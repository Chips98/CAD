graph TD
    subgraph "ğŸ–¥ï¸ ç”¨æˆ·ç•Œé¢å±‚"
        A["ä¸»ç¨‹åº<br/>main.py"]
        A1["æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯"]
        A2["æ˜¾ç¤ºèœå•"]
        A3["é€‰æ‹©AIæä¾›å•†"]
        A4["æ˜¾ç¤ºæ¨¡æ‹Ÿä¿¡æ¯"]
        
        B["å’¨è¯¢ç¨‹åº<br/>start_therapy_from_logs.py"]
        B1["æ‰«ææ¨¡æ‹Ÿè®°å½•"]
        B2["æ˜¾ç¤ºè¿è¡Œèœå•"]
    end
    
    subgraph "âš™ï¸ ä¸šåŠ¡é€»è¾‘å±‚"
        C["æ¨¡æ‹Ÿå¼•æ“<br/>SimulationEngine"]
        C1["åˆå§‹åŒ–æ¨¡æ‹Ÿ"]
        C2["è®¾ç½®æ™ºèƒ½ä½“"]
        C3["è¿è¡Œ30å¤©æ¨¡æ‹Ÿ"]
        C4["æ¨¡æ‹Ÿå•æ—¥æ´»åŠ¨"]
        C5["ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š"]
        
        D["å¿ƒç†å’¨è¯¢ç®¡ç†å™¨<br/>TherapySessionManager"]
        D1["åŠ è½½æ‚£è€…æ•°æ®"]
        D2["è·å–æ‚£è€…å›åº”"]
        D3["è¯„ä¼°å¯¹è¯æ•ˆæœ"]
        D4["æ›´æ–°æŠ‘éƒç¨‹åº¦"]
        D5["ä¿å­˜å’¨è¯¢è®°å½•"]
    end
    
    subgraph "ğŸ”§ æ ¸å¿ƒç»„ä»¶å±‚"
        E["äº‹ä»¶ç”Ÿæˆå™¨<br/>EventGenerator"]
        E1["ç”Ÿæˆäº‹ä»¶"]
        E2["æ„å»ºä¸Šä¸‹æ–‡"]
        E3["è§„åˆ™ç”Ÿæˆ"]
        
        F["AIå®¢æˆ·ç«¯å·¥å‚<br/>AIClientFactory"]
        F1["è·å–å®¢æˆ·ç«¯"]
        F2["æ£€æŸ¥å¯ç”¨æä¾›å•†"]
        
        G["æ™ºèƒ½ä½“ç³»ç»Ÿ<br/>Agent System"]
        G1["å“åº”æƒ…å†µ"]
        G2["å†…å¿ƒç‹¬ç™½"]
        G3["å¤„ç†äº‹ä»¶å½±å“"]
    end
    
    subgraph "ğŸ¤– AIåˆ†æå±‚"
        H["æ¨¡æ¿åˆ†æå™¨<br/>TemplateAnalyzer"]
        H1["åˆ†ææ¨¡å¼"]
        H2["é€‰æ‹©æœ€ä½³æ¨¡å¼"]
        
        I["ä¸Šä¸‹æ–‡æå–å™¨<br/>ContextExtractor"]
        I1["æå–ä¸Šä¸‹æ–‡"]
        
        J["é€»è¾‘éªŒè¯å™¨<br/>LogicValidator"]
        J1["éªŒè¯å¹¶ä¿®å¤"]
        
        K["å‘æ•£ç”Ÿæˆå™¨<br/>DivergentGenerator"]
        K1["ä»æ¨¡å¼ç”Ÿæˆ"]
    end
    
    subgraph "ğŸ’» AIå®¢æˆ·ç«¯å±‚"
        L["Geminiå®¢æˆ·ç«¯"]
        L1["ç”Ÿæˆå›åº”"]
        
        M["DeepSeekå®¢æˆ·ç«¯"]
        M1["ç”Ÿæˆå›åº”"]
    end
    
    subgraph "ğŸ‘¥ æ™ºèƒ½ä½“å±‚"
        N["å­¦ç”Ÿæ™ºèƒ½ä½“<br/>ææ˜"]
        N1["è·å–æŠ‘éƒç—‡çŠ¶"]
        N2["å­¦ä¹ è¡Œä¸º"]
        
        O["å®¶åº­æ™ºèƒ½ä½“"]
        O1["çˆ¶äº²ï¼šè®¾å®šæœŸæœ›"]
        O2["æ¯äº²ï¼šå®‰æ…°å­©å­"]
        
        P["å­¦æ ¡æ™ºèƒ½ä½“"]
        P1["è€å¸ˆï¼šåé¦ˆè¡¨ç°"]
        P2["éœ¸å‡Œè€…ï¼šéœ¸å‡Œè¡Œä¸º"]
        P3["å¥½å‹ï¼šæƒ…æ„Ÿæ”¯æŒ"]
        
        Q["å¿ƒç†å’¨è¯¢å¸ˆ"]
        Q1["æä¾›ç£å¯¼"]
        Q2["åˆ†ææ‚£è€…çŠ¶æ€"]
    end
    
    subgraph "ğŸ“Š æ•°æ®æ¨¡å‹å±‚"
        R["å¿ƒç†å­¦æ¨¡å‹"]
        R1["å¿ƒç†çŠ¶æ€"]
        R2["ç”Ÿæ´»äº‹ä»¶"]
        R3["å…³ç³»æ¨¡å‹"]
        
        S["é…ç½®ç³»ç»Ÿ"]
        S1["è§’è‰²é…ç½®"]
        S2["äº‹ä»¶æ¨¡æ¿"]
        S3["é˜¶æ®µé…ç½®"]
        
        T["æ•°æ®å­˜å‚¨"]
        T1["æœ€ç»ˆæŠ¥å‘Š"]
        T2["æ¯æ—¥çŠ¶æ€"]
        T3["å’¨è¯¢è®°å½•"]
    end
    
    subgraph "ğŸŒ å¤–éƒ¨æœåŠ¡"
        U["Google Gemini API"]
        V["DeepSeek API"]
    end
    
    %% ä¸»è¦æ•°æ®æµå‘ï¼ˆå‚ç›´æ–¹å‘ï¼‰
    A --> C
    B --> D
    A --> A1
    A1 --> A2
    A2 --> A3
    A3 --> A4
    B --> B1
    B1 --> B2
    
    C --> C1
    C1 --> C2
    C2 --> C3
    C3 --> C4
    C4 --> C5
    
    D --> D1
    D1 --> D2
    D2 --> D3
    D3 --> D4
    D4 --> D5
    
    C --> E
    D --> F
    E --> E1
    E1 --> E2
    E2 --> E3
    
    F --> F1
    F1 --> F2
    
    G --> G1
    G1 --> G2
    G2 --> G3
    
    E --> H
    H --> H1
    H1 --> H2
    
    E --> I
    I --> I1
    
    E --> J
    J --> J1
    
    E --> K
    K --> K1
    
    F --> L
    F --> M
    L --> L1
    M --> M1
    
    G --> N
    G --> O
    G --> P
    D --> Q
    
    N --> N1
    N1 --> N2
    
    O --> O1
    O1 --> O2
    
    P --> P1
    P1 --> P2
    P2 --> P3
    
    Q --> Q1
    Q1 --> Q2
    
    N --> R
    O --> R
    P --> R
    R --> R1
    R1 --> R2
    R2 --> R3
    
    C --> S
    S --> S1
    S1 --> S2
    S2 --> S3
    
    C --> T
    D --> T
    T --> T1
    T1 --> T2
    T2 --> T3
    
    L --> U
    M --> V
    
    %% æ ·å¼è®¾ç½®
    classDef userInterface fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,font-size:14px
    classDef businessLogic fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,font-size:14px
    classDef coreComponents fill:#e8f5e8,stroke:#388e3c,stroke-width:3px,font-size:14px
    classDef analyzers fill:#fff8e1,stroke:#f57c00,stroke-width:3px,font-size:14px
    classDef aiClients fill:#fce4ec,stroke:#c2185b,stroke-width:3px,font-size:14px
    classDef agents fill:#e0f2f1,stroke:#00695c,stroke-width:3px,font-size:14px
    classDef dataModels fill:#fff3e0,stroke:#ef6c00,stroke-width:3px,font-size:14px
    classDef external fill:#f1f8e9,stroke:#558b2f,stroke-width:3px,font-size:14px
    
    class A,A1,A2,A3,A4,B,B1,B2 userInterface
    class C,C1,C2,C3,C4,C5,D,D1,D2,D3,D4,D5 businessLogic
    class E,E1,E2,E3,F,F1,F2,G,G1,G2,G3 coreComponents
    class H,H1,H2,I,I1,J,J1,K,K1 analyzers
    class L,L1,M,M1 aiClients
    class N,N1,N2,O,O1,O2,P,P1,P2,P3,Q,Q1,Q2 agents
    class R,R1,R2,R3,S,S1,S2,S3,T,T1,T2,T3 dataModels
    class U,V external