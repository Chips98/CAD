# 配置系统说明

本目录包含抑郁症模拟系统的所有配置文件，支持YAML和JSON两种格式。系统会优先使用YAML格式的配置文件，如果YAML文件不存在则回退到JSON格式。

## 📋 配置文件概览

### 核心配置文件

| 文件名 | 格式 | 用途 | 说明 |
|--------|------|------|------|
| `api_config.yaml` | YAML | API配置 | 配置各AI模型提供商的API密钥和参数 |
| `simulation_params.yaml` | YAML | 模拟参数 | 控制抑郁症模拟的基础参数 |
| `therapy_guidance_config.yaml` | YAML | 通用治疗配置 | 通用的心理治疗参数和阈值 |
| `human_therapy_config.yaml` | YAML | 人类治疗师配置 | 针对人类治疗师优化的参数 |
| `ai_to_ai_therapy_config.yaml` | YAML | AI-AI治疗配置 | 针对AI自动化治疗优化的参数 |

### 辅助文件

| 文件名 | 用途 |
|--------|------|
| `config_loader.py` | 配置加载器，支持YAML/JSON双格式 |
| `scenario_selector.py` | 剧本选择器，提供交互式剧本选择 |
| `CONFIG_PARAMETERS.md` | 参数详细说明文档 |

### 场景配置

`scenarios/` 目录包含各种剧本场景配置：

- `default_adolescent.json` - 默认青少年抑郁场景
- `primary_school_bullying.json` - 小学生校园暴力场景  
- `university_graduation_pressure.json` - 大学生毕业压力场景
- `workplace_pua_depression.json` - 职场PUA抑郁场景

## 🔧 配置格式转换

系统已从JSON格式升级到YAML格式，主要优势：

### YAML格式优势
- ✅ **支持注释** - 每个参数都有详细的中文注释
- ✅ **可读性更好** - 更清晰的层次结构
- ✅ **参数说明** - 包含建议范围和物理意义
- ✅ **向下兼容** - 仍支持原有JSON文件

### 参数注释示例

```yaml
# 治疗有效性参数
therapy_effectiveness:
  # 基础改善因子
  # 建议范围: 0.3-0.8
  # 物理意义: 每轮治疗的基础改善幅度
  # 较高值使治疗效果更明显，较低值更接近现实
  base_improvement_factor: 0.5
```

## 🎭 剧本选择功能

新增的剧本选择器支持：

### 交互式选择
- 显示所有可用剧本的详细信息
- 包含主角、年龄、描述等信息
- 支持数字编号选择

### 自动筛选
- 支持按剧本类型筛选模拟数据
- 在治疗脚本中可选择特定剧本的数据
- 模糊匹配和精确匹配

### 验证功能
- 自动验证剧本配置的完整性
- 检查必需的角色和关系配置
- 提供友好的错误提示

## 🚀 使用方法

### 1. 运行主模拟程序
```bash
python main.py
```
- 会提示选择剧本类型
- 显示可用剧本列表
- 支持交互式选择

### 2. 启动AI-AI治疗
```bash
python start_ai_to_ai_therapy.py
```
- 可选择按剧本类型筛选数据
- 自动加载对应的AI治疗配置

### 3. 从日志启动治疗
```bash
python start_therapy_from_logs.py
```
- 支持剧本类型筛选
- 加载人类治疗师优化配置

## ⚙️ 配置优先级

1. **环境变量** - API密钥优先使用环境变量
2. **YAML配置** - 优先加载 `.yaml` 文件
3. **JSON配置** - 回退到 `.json` 文件  
4. **默认配置** - 使用内置默认值

## 📊 配置差异化

系统针对不同使用场景提供了差异化配置：

### 人类治疗师配置 (`human_therapy_config.yaml`)
- **更高的治疗效果** - 体现人类专业优势
- **更强的情感支持** - 人类共情能力
- **更详细的督导** - 需要更多专业指导

### AI-AI治疗配置 (`ai_to_ai_therapy_config.yaml`)  
- **保守的治疗效果** - 避免过于理想化
- **自动化设置** - 支持无人干预运行
- **稳定性优先** - AI的一致性优势

### 通用配置 (`therapy_guidance_config.yaml`)
- **平衡的参数** - 适用于大多数场景
- **中等效果** - 既不过于保守也不过于激进
- **灵活的阈值** - 适应性强

## 🔍 参数调优指南

详细的参数说明请参考 `CONFIG_PARAMETERS.md`，包含：

- 每个参数的建议范围
- 物理意义和影响
- 调优建议和注意事项
- 不同场景的推荐值

## 🛠️ 故障排除

### 常见问题

1. **配置文件加载失败**
   - 检查YAML语法是否正确
   - 确认文件编码为UTF-8
   - 查看控制台错误信息

2. **剧本选择异常**
   - 确认scenarios目录下有有效配置文件
   - 检查剧本配置的完整性
   - 验证必需字段是否存在

3. **API配置问题**
   - 检查API密钥是否正确
   - 确认网络连接正常
   - 验证提供商配置是否启用

### 调试模式

在配置文件中启用调试模式：

```yaml
logging:
  log_level: "DEBUG"
  enable_debug_mode: true
```

这会输出详细的配置加载和参数使用信息。 