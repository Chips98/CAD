**数据流说明：**

1.  **模拟阶段**：
    
    -   `main.py` 启动，加载 `config.py` 的全局设置和 `sim_config` 里的场景配置。
    -   `SimulationEngine` 被创建，并根据配置初始化所有的 `Agent`。
    -   引擎按天推进循环。每天，`EventGenerator` 会生成多个事件。
    -   事件（`LifeEvent`）对主角的`PsychologicalState`产生影响。
    -   每天结束时，主角的完整状态被保存为一个`day_X_state.json`文件。
    -   30天模拟结束后，生成一个总的`final_report.json`。所有这些文件都保存在一个带时间戳的独立文件夹 `logs/sim_...` 中，确保了每次运行的隔离性。
2.  **咨询阶段**：
    
    -   `start_therapy_from_logs.py` 启动，扫描 `logs` 目录并让用户选择一个模拟记录。
    -   `TherapySessionManager` 被创建，并从选定的 `final_report.json`（或整合的每日历史）中加载主角的性格、记忆（重要事件）和最终心理状态。
    -   用户输入的每一句话，都会和主角的完整背景、记忆、当前对话历史一起，被构造成一个复杂的Prompt，发送给AI生成回应。
    -   **恢复机制** 在此阶段生效。系统会评估对话效果，并根据效果分数和治疗联盟分数，微调主角的抑郁等级，实现状态的动态变化。
    -   咨询结束后，完整的对话记录和恢复过程会被保存到同一个模拟文件夹下的 `therapy_session.json` 文件中。

### 总结与后续工作建议

这个项目设计得非常模块化和可扩展。

-   **如果想修改或添加角色**：你只需要在 `agents` 目录中创建新的Agent类（或修改现有类），然后在 `sim_config` 文件中进行定义即可。
-   **如果想创建一个全新的模拟场景**：最佳实践是复制一份 `sim_config/simulation_config.py`，然后在新文件中大胆修改 `CHARACTERS`, `RELATIONSHIPS`, 和 `EVENT_TEMPLATES`。例如，可以设计一个“办公室职场PUA”的场景。
-   **如果想调整心理模型的细节**：核心逻辑在 `models/psychology_models.py` (定义状态) 和 `agents/base_agent.py` 的 `_process_event_impact` 方法 (处理事件影响)。
-   **如果想改进咨询体验**：主要关注 `core/therapy_session_manager.py` 中的 `_generate_prompt_for_patient` 方法（决定了AI角色的回应质量）和 `_evaluate_conversation_effectiveness` 方法（决定了恢复机制的灵敏度）。




### **核心构想：抑郁症认知-情感动力学模型 (Cognitive-Affective Dynamics Model of Depression, CAD-MD)**

我们不再沿用普适性的“认知链”，而是专门为抑郁症的形成和发展，提炼一个更具针对性的动态模型。这个模型的核心，是模拟在外界压力事件下，个体内部的**核心信念**、**认知加工方式**和**情绪/行为**之间如何形成恶性循环。

我们将构建一个新的状态链，包含以下几个核心维度：

1.  **情感基调 (Affective Tone / Mood)**：
    
    -   **定义**：沿用你的概念，这是个体长期、稳定的人格化情感背景（如乐观/悲观）。它是后续所有反应的“底色”。
    -   **作用**：决定了个体对中性或模糊事件的初始解读倾向。
2.  **核心信念 (Core Beliefs) - 贝克认知三角**：
    
    -   **定义**：这是模型的**核心创新**。我们直接引入抑郁症认知疗法之父亚伦·贝克（Aaron Beck）的\*\*认知三角（Cognitive Triad）\*\*理论，将它作为三个独立的维度来建模。这是抑郁症最核心的认知特征。
        -   **自我信念 (Self-Belief)**：对自己无价值、无能、有缺陷的看法。
        -   **世界/经验信念 (World-Belief)**：对周遭世界和个人经历充满困难、挫败和不公的看法。
        -   **未来信念 (Future-Belief)**：对未来充满绝望、无助和悲观的看法。
    -   **作用**：这三个负面信念是抑郁思维的根源，它们相互强化，并直接影响认知加工。
3.  **认知加工 (Cognitive Processing)**：
    
    -   **定义**：这取代了你模型中泛化的“思维”，聚焦于与抑郁症最相关的两种思维模式。
        -   **负性思维反刍 (Rumination)**：个体被动、重复地思考负面情绪及其可能的原因和后果。
        -   **认知扭曲 (Cognitive Distortions)**：系统性的思维偏差，如“非黑即白”、“灾难化”、“过度泛化”等。
    -   **作用**：这是连接“核心信念”和“情绪状态”的桥梁。负面信念会触发反刍和扭曲，而这些加工方式又会急剧放大负面情绪。
4.  **情绪状态 (Emotional State)**：
    
    -   **定义**：与你模型中的“情绪”类似，是个体对特定事件的即时、强烈的情感反应（如悲伤、焦虑、麻木）。
    -   **作用**：情绪是内在状态的外显，并会反作用于行为。
5.  **行为倾向 (Behavioral Inclination)**：
    
    -   **定义**：取代了你模型中更偏社会参与的“意图”，我们关注与抑郁强相关的行为模式。
        -   **社交退缩 (Social Withdrawal)**：回避社交活动的倾向。
        -   **动机降低 (Anhedonia/Avolition)**：体验快乐的能力下降和从事目标导向行为的动力减弱。
        -   **应对方式 (Coping Style)**：面对压力时，是倾向于积极解决问题还是消极回避。
    -   **作用**：行为是认知和情感的最终输出。而行为（尤其是回避和退缩）又会减少获得积极反馈的机会，从而进一步强化负面的核心信念，形成闭环。



